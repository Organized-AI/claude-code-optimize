"use strict";(()=>{var e={};e.id=851,e.ids=[851],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},9025:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>p,dynamic:()=>c,revalidate:()=>l});var o=r(9303),a=r(8716),n=r(670),i=r(7070),u=r(6607);let c="force-dynamic",l=0;async function p(){try{let e=await (0,u.s$)();if(!e)return i.NextResponse.json(null);let t=await (0,u.y4)(e.sessionId);return i.NextResponse.json({...e,session:t})}catch(e){return console.error("Error in active-session API:",e),i.NextResponse.json({error:"Failed to fetch active session"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/active-session/route",pathname:"/api/active-session",filename:"route",bundlePath:"app/api/active-session/route"},resolvedPagePath:"/Users/jordaaan/Library/Mobile Documents/com~apple~CloudDocs/BHT Promo iCloud/Organized AI/Windsurf/Claude Code Optimizer/moonlock-cli/moonlock-dashboard/app/api/active-session/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=d,y="/api/active-session/route";function v(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},6607:(e,t,r)=>{r.d(t,{s$:()=>p,y4:()=>d,Rx:()=>c,aC:()=>m,zE:()=>l});let s=require("fs");var o=r(1017),a=r.n(o);let n=require("os");var i=r.n(n);let u=()=>{let e=i().homedir();return a().join(e,".moonlock")};async function c(){try{let e=u(),t=a().join(e,"sessions");try{await s.promises.access(t)}catch{return[]}let r=await s.promises.readdir(t),o=[];for(let e of r)if(e.endsWith(".json"))try{let r=a().join(t,e),n=await s.promises.readFile(r,"utf-8"),i=JSON.parse(n);o.push(i)}catch(t){console.error(`Error reading session file ${e}:`,t)}return o.sort((e,t)=>new Date(t.lastUsed).getTime()-new Date(e.lastUsed).getTime()),o}catch(e){return console.error("Error reading sessions:",e),[]}}async function l(e){try{let t=u(),r=a().join(t,"tokens");try{await s.promises.access(r)}catch{return[]}let o=await s.promises.readdir(r),n=[];for(let t of o)if(t.endsWith(".json")){if(e&&!t.includes(e))continue;try{let e=a().join(r,t),o=await s.promises.readFile(e,"utf-8"),i=JSON.parse(o);Array.isArray(i)?n.push(...i):n.push(i)}catch(e){console.error(`Error reading token file ${t}:`,e)}}return n.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),n}catch(e){return console.error("Error reading token usage:",e),[]}}async function p(){try{let e=u(),t=a().join(e,"active-session"),r=await s.promises.readFile(t,"utf-8");return JSON.parse(r)}catch(e){return null}}async function d(e){try{let t=u(),r=a().join(t,"sessions",`${e}.json`),o=await s.promises.readFile(r,"utf-8");return JSON.parse(o)}catch(t){return console.error(`Error reading session ${e}:`,t),null}}async function m(){let e=await c(),t=await l(),r=e.length,s=e.filter(e=>"active"===e.status).length,o=t.reduce((e,t)=>e+t.total,0),a=new Date;a.setHours(0,0,0,0);let n=t.filter(e=>new Date(e.timestamp)>=a).reduce((e,t)=>e+t.total,0),i=new Date;return i.setDate(1),i.setHours(0,0,0,0),{totalSessions:r,activeSessions:s,totalTokens:o,todayUsage:n,monthlyUsage:t.filter(e=>new Date(e.timestamp)>=i).reduce((e,t)=>e+t.total,0),providerUsage:t.reduce((e,t)=>{let r=t.provider||"unknown";return e[r]||(e[r]={input:0,output:0,total:0}),e[r].input+=t.input,e[r].output+=t.output,e[r].total+=t.total,e},{})}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972],()=>r(9025));module.exports=s})();