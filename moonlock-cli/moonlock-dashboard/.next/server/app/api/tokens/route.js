"use strict";(()=>{var e={};e.id=277,e.ids=[277],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},3267:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>p,dynamic:()=>l,revalidate:()=>c});var s=r(9303),n=r(8716),a=r(670),i=r(7070),u=r(6607);let l="force-dynamic",c=0;async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("sessionId"),o=await (0,u.zE)(r||void 0);return i.NextResponse.json(o)}catch(e){return console.error("Error in tokens API:",e),i.NextResponse.json({error:"Failed to fetch token usage"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/tokens/route",pathname:"/api/tokens",filename:"route",bundlePath:"app/api/tokens/route"},resolvedPagePath:"/Users/jordaaan/Library/Mobile Documents/com~apple~CloudDocs/BHT Promo iCloud/Organized AI/Windsurf/Claude Code Optimizer/moonlock-cli/moonlock-dashboard/app/api/tokens/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=d,g="/api/tokens/route";function y(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},6607:(e,t,r)=>{r.d(t,{s$:()=>p,y4:()=>d,Rx:()=>l,aC:()=>m,zE:()=>c});let o=require("fs");var s=r(1017),n=r.n(s);let a=require("os");var i=r.n(a);let u=()=>{let e=i().homedir();return n().join(e,".moonlock")};async function l(){try{let e=u(),t=n().join(e,"sessions");try{await o.promises.access(t)}catch{return[]}let r=await o.promises.readdir(t),s=[];for(let e of r)if(e.endsWith(".json"))try{let r=n().join(t,e),a=await o.promises.readFile(r,"utf-8"),i=JSON.parse(a);s.push(i)}catch(t){console.error(`Error reading session file ${e}:`,t)}return s.sort((e,t)=>new Date(t.lastUsed).getTime()-new Date(e.lastUsed).getTime()),s}catch(e){return console.error("Error reading sessions:",e),[]}}async function c(e){try{let t=u(),r=n().join(t,"tokens");try{await o.promises.access(r)}catch{return[]}let s=await o.promises.readdir(r),a=[];for(let t of s)if(t.endsWith(".json")){if(e&&!t.includes(e))continue;try{let e=n().join(r,t),s=await o.promises.readFile(e,"utf-8"),i=JSON.parse(s);Array.isArray(i)?a.push(...i):a.push(i)}catch(e){console.error(`Error reading token file ${t}:`,e)}}return a.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),a}catch(e){return console.error("Error reading token usage:",e),[]}}async function p(){try{let e=u(),t=n().join(e,"active-session"),r=await o.promises.readFile(t,"utf-8");return JSON.parse(r)}catch(e){return null}}async function d(e){try{let t=u(),r=n().join(t,"sessions",`${e}.json`),s=await o.promises.readFile(r,"utf-8");return JSON.parse(s)}catch(t){return console.error(`Error reading session ${e}:`,t),null}}async function m(){let e=await l(),t=await c(),r=e.length,o=e.filter(e=>"active"===e.status).length,s=t.reduce((e,t)=>e+t.total,0),n=new Date;n.setHours(0,0,0,0);let a=t.filter(e=>new Date(e.timestamp)>=n).reduce((e,t)=>e+t.total,0),i=new Date;return i.setDate(1),i.setHours(0,0,0,0),{totalSessions:r,activeSessions:o,totalTokens:s,todayUsage:a,monthlyUsage:t.filter(e=>new Date(e.timestamp)>=i).reduce((e,t)=>e+t.total,0),providerUsage:t.reduce((e,t)=>{let r=t.provider||"unknown";return e[r]||(e[r]={input:0,output:0,total:0}),e[r].input+=t.input,e[r].output+=t.output,e[r].total+=t.total,e},{})}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972],()=>r(3267));module.exports=o})();