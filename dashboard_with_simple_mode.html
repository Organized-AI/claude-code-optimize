<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Optimizer Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header with mode toggle */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .dashboard-title {
            color: white;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Advanced dashboard styles (existing) */
        .advanced-dashboard {
            display: block;
        }
        
        .advanced-dashboard.hidden {
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .stat-card.sonnet-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .stat-card.opus-card {
            background: linear-gradient(135deg, #a855f7 0%, #c084fc 100%);
            color: white;
        }
        
        .stat-card.session-tracker-card {
            background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
            color: white;
        }
        
        .session-timer {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 2.5em !important;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .session-progress-container {
            margin: 15px 0;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .session-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 70%, #ef4444 100%);
            border-radius: 4px;
            transition: width 1s ease;
            width: 0%;
        }
        
        .session-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 15px 0;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
        }
        
        .stat-title {
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-section, .info-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.4em;
            margin-bottom: 20px;
            color: #333;
            font-weight: 600;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 500;
            color: #666;
        }
        
        .info-value {
            font-weight: 600;
            color: #333;
        }
        
        .footer {
            text-align: center;
            color: white;
            opacity: 0.8;
            margin-top: 40px;
        }
        
        /* Simple dashboard container */
        .simple-dashboard-container {
            display: none;
        }
        
        .simple-dashboard-container.active {
            display: block;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .dashboard-title {
                font-size: 2em;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with mode toggle -->
        <div class="dashboard-header">
            <h1 class="dashboard-title">Claude Code Optimizer</h1>
            <div id="mode-toggle-container"></div>
        </div>
        
        <!-- Simple Dashboard View -->
        <div id="simple-dashboard-container" class="simple-dashboard-container">
            <div id="simple-dashboard"></div>
        </div>
        
        <!-- Advanced Dashboard View (existing dashboard) -->
        <div id="advanced-dashboard" class="advanced-dashboard">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <!-- Current Session Tracker -->
                <div class="stat-card session-tracker-card">
                    <div class="stat-title">üïê Current Session</div>
                    <div id="session-timer" class="session-timer">00:00:00</div>
                    <div class="session-progress-container">
                        <div id="session-progress" class="session-progress-bar"></div>
                    </div>
                    <div class="session-info">
                        <div class="info-row">
                            <span>Model:</span>
                            <span id="current-model">Detecting...</span>
                        </div>
                        <div class="info-row">
                            <span>Tokens:</span>
                            <span id="session-tokens">0</span>
                        </div>
                        <div class="info-row">
                            <span>Status:</span>
                            <span id="session-status">Initializing</span>
                        </div>
                    </div>
                </div>
                
                <!-- Sonnet Usage -->
                <div class="stat-card sonnet-card">
                    <div class="stat-title">üß† Sonnet Usage</div>
                    <div id="sonnet-hours" class="stat-value">0.0</div>
                    <div class="stat-label">Hours this week</div>
                    <div style="margin-top: 15px;">
                        <div style="font-size: 0.9em; margin-bottom: 5px;">
                            <span id="sonnet-percentage">0%</span> of 432h limit
                        </div>
                        <div style="font-size: 0.8em; opacity: 0.8;">
                            <span id="sonnet-tokens">0</span> tokens
                        </div>
                    </div>
                </div>
                
                <!-- Opus Usage -->
                <div class="stat-card opus-card">
                    <div class="stat-title">üéØ Opus Usage</div>
                    <div id="opus-hours" class="stat-value">0.0</div>
                    <div class="stat-label">Hours this week</div>
                    <div style="margin-top: 15px;">
                        <div style="font-size: 0.9em; margin-bottom: 5px;">
                            <span id="opus-percentage">0%</span> of 36h limit
                        </div>
                        <div style="font-size: 0.8em; opacity: 0.8;">
                            <span id="opus-tokens">0</span> tokens
                        </div>
                    </div>
                </div>
                
                <!-- Weekly Summary -->
                <div class="stat-card">
                    <div class="stat-title">üìä Weekly Summary</div>
                    <div id="total-sessions" class="stat-value">0</div>
                    <div class="stat-label">Total sessions</div>
                    <div style="margin-top: 15px;">
                        <div style="font-size: 0.9em; margin-bottom: 5px;">
                            <span id="total-hours">0.0</span> hours total
                        </div>
                        <div style="font-size: 0.8em; color: #666;">
                            <span id="efficiency-score">0.0</span> efficiency score
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Chart Section -->
                <div class="chart-section">
                    <h3 class="section-title">üìà Usage Trends</h3>
                    <div id="usage-chart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: #666;">
                        Usage chart will be displayed here
                    </div>
                </div>
                
                <!-- Info Section -->
                <div class="info-section">
                    <h3 class="section-title">‚ÑπÔ∏è Session Details</h3>
                    <div id="session-details">
                        <div class="info-item">
                            <span class="info-label">Start Time:</span>
                            <span id="session-start" class="info-value">Not started</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span id="session-duration" class="info-value">00:00:00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Project:</span>
                            <span id="current-project" class="info-value">Unknown</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Last Activity:</span>
                            <span id="last-activity" class="info-value">None</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Quota Status:</span>
                            <span id="quota-status" class="info-value">üü¢ Safe</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Claude Code Optimizer - Intelligent session tracking and optimization</p>
            <p>ccusage-compatible with enhanced planning features</p>
        </div>
    </div>

    <!-- Load components -->
    <script src="src/components/simple/ModeToggle.js"></script>
    <script src="src/components/simple/SimpleDashboard.js"></script>
    
    <!-- Main dashboard script -->
    <script>
        class ClaudeCodeDashboard {
            constructor() {
                this.sessionStart = null;
                this.currentModel = null;
                this.sessionTokens = 0;
                this.isActive = false;
                this.currentMode = 'simple';
                
                this.initializeModeToggle();
                this.initializeSimpleDashboard();
                this.startMonitoring();
            }
            
            initializeModeToggle() {
                // Initialize mode toggle
                window.modeToggle = new ModeToggle('mode-toggle-container');
                window.modeToggle.setOnModeChange((mode) => {
                    this.switchMode(mode);
                });
                
                // Set initial mode
                this.switchMode(window.modeToggle.currentMode);
            }
            
            initializeSimpleDashboard() {
                window.simpleDashboard = new SimpleDashboard('simple-dashboard');
            }
            
            switchMode(mode) {
                this.currentMode = mode;
                
                const simpleContainer = document.getElementById('simple-dashboard-container');
                const advancedContainer = document.getElementById('advanced-dashboard');
                
                if (mode === 'simple') {
                    simpleContainer.classList.add('active');
                    advancedContainer.classList.add('hidden');
                } else {
                    simpleContainer.classList.remove('active');
                    advancedContainer.classList.remove('hidden');
                }
                
                // Add animation
                document.body.classList.add('mode-switch-animation');
                setTimeout(() => {
                    document.body.classList.remove('mode-switch-animation');
                }, 500);
            }
            
            async startMonitoring() {
                // Initial load
                await this.updateDashboard();
                
                // Set up periodic updates
                setInterval(() => {
                    this.updateDashboard();
                }, 30000); // Update every 30 seconds
                
                // Update timer every second if active
                setInterval(() => {
                    if (this.currentMode === 'advanced') {
                        this.updateTimer();
                    }
                }, 1000);
            }
            
            async updateDashboard() {
                try {
                    // Fetch data from all endpoints
                    const [statusResponse, limitsResponse, weeklyResponse] = await Promise.all([
                        fetch('/api/status/current'),
                        fetch('/api/limits/weekly'),
                        fetch('/api/reports/weekly')
                    ]);
                    
                    const statusData = await statusResponse.json();
                    const limitsData = await limitsResponse.json();
                    const weeklyData = await weeklyResponse.json();
                    
                    // Update advanced dashboard
                    if (this.currentMode === 'advanced') {
                        this.updateAdvancedDashboard(statusData, limitsData, weeklyData);
                    }
                    
                } catch (error) {
                    console.error('Failed to fetch dashboard data:', error);
                    this.showError('Failed to connect to monitoring service');
                }
            }
            
            updateAdvancedDashboard(status, limits, weekly) {
                // Update session info
                if (status && status.active_session) {
                    this.isActive = true;
                    this.sessionStart = new Date(status.start_time);
                    this.currentModel = status.model;
                    this.sessionTokens = status.tokens_used || 0;
                    
                    document.getElementById('current-model').textContent = this.currentModel.charAt(0).toUpperCase() + this.currentModel.slice(1);
                    document.getElementById('session-tokens').textContent = this.sessionTokens.toLocaleString();
                    document.getElementById('session-status').textContent = 'Active';
                    document.getElementById('session-start').textContent = this.sessionStart.toLocaleString();
                    document.getElementById('current-project').textContent = status.project_name || 'Unknown';
                    
                    // Update progress bar
                    const duration = status.duration_hours || 0;
                    const progressPercent = Math.min((duration / 5) * 100, 100);
                    document.getElementById('session-progress').style.width = progressPercent + '%';
                    
                } else {
                    this.isActive = false;
                    document.getElementById('current-model').textContent = 'None';
                    document.getElementById('session-tokens').textContent = '0';
                    document.getElementById('session-status').textContent = 'Idle';
                    document.getElementById('session-start').textContent = 'Not started';
                    document.getElementById('session-progress').style.width = '0%';
                }
                
                // Update weekly usage
                if (limits && limits.usage) {
                    const usage = limits.usage;
                    
                    // Sonnet
                    document.getElementById('sonnet-hours').textContent = (usage.sonnet || 0).toFixed(1);
                    document.getElementById('sonnet-percentage').textContent = 
                        ((usage.sonnet || 0) / 432 * 100).toFixed(1) + '%';
                    
                    // Opus
                    document.getElementById('opus-hours').textContent = (usage.opus || 0).toFixed(1);
                    document.getElementById('opus-percentage').textContent = 
                        ((usage.opus || 0) / 36 * 100).toFixed(1) + '%';
                }
                
                // Update weekly summary
                if (weekly && weekly.summary) {
                    const summary = weekly.summary;
                    document.getElementById('total-sessions').textContent = summary.total_sessions || 0;
                    document.getElementById('total-hours').textContent = (summary.total_duration_hours || 0).toFixed(1);
                    document.getElementById('efficiency-score').textContent = (weekly.efficiency_score || 0).toFixed(1);
                }
                
                // Update quota status
                if (limits && limits.traffic_light) {
                    const tl = limits.traffic_light;
                    document.getElementById('quota-status').textContent = `${tl.emoji} ${tl.message}`;
                }
                
                // Update last activity
                document.getElementById('last-activity').textContent = new Date().toLocaleTimeString();
            }
            
            updateTimer() {
                if (!this.isActive || !this.sessionStart) {
                    document.getElementById('session-timer').textContent = '00:00:00';
                    document.getElementById('session-duration').textContent = '00:00:00';
                    return;
                }
                
                const now = new Date();
                const elapsed = Math.floor((now - this.sessionStart) / 1000);
                
                const hours = Math.floor(elapsed / 3600);
                const minutes = Math.floor((elapsed % 3600) / 60);
                const seconds = elapsed % 60;
                
                const timeString = 
                    String(hours).padStart(2, '0') + ':' +
                    String(minutes).padStart(2, '0') + ':' +
                    String(seconds).padStart(2, '0');
                
                document.getElementById('session-timer').textContent = timeString;
                document.getElementById('session-duration').textContent = timeString;
            }
            
            showError(message) {
                console.error(message);
                // Could add error display UI here
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new ClaudeCodeDashboard();
        });
    </script>
</body>
</html>