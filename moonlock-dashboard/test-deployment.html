<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Optimizer Dashboard - Deployment Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        h1 {
            color: #60a5fa;
            text-align: center;
        }
        .test-section {
            background: #1e293b;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #334155;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #166534;
            color: #4ade80;
        }
        .error {
            background: #7f1d1d;
            color: #f87171;
        }
        .loading {
            background: #422006;
            color: #fbbf24;
        }
        pre {
            background: #0f172a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-right: 5px;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>
<body>
    <h1>Claude Code Optimizer Dashboard - Deployment Test</h1>
    
    <div class="test-section">
        <h2>Deployment Information</h2>
        <p><strong>Production URL:</strong> <a href="https://claude-code-optimizer-dashboard.vercel.app" target="_blank" style="color: #60a5fa;">https://claude-code-optimizer-dashboard.vercel.app</a></p>
        <p><strong>Deployment Time:</strong> <span id="deployTime"></span></p>
        <p><strong>Status:</strong> <span class="live-indicator"></span>LIVE</p>
    </div>
    
    <div class="test-section">
        <h2>API Endpoint Tests</h2>
        <div id="apiTests"></div>
    </div>
    
    <div class="test-section">
        <h2>Live Session Data</h2>
        <div id="liveData"></div>
    </div>
    
    <script>
        const BASE_URL = 'https://claude-code-optimizer-dashboard.vercel.app';
        const API_ENDPOINTS = [
            '/api/claude-code/live-status',
            '/api/claude-code/precision-metrics',
            '/api/claude-code/budget-progress',
            '/api/claude-code/history',
            '/api/claude-code/analytics'
        ];
        
        document.getElementById('deployTime').textContent = new Date().toLocaleString();
        
        async function testEndpoint(endpoint) {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-result loading';
            testDiv.innerHTML = `Testing ${endpoint}...`;
            document.getElementById('apiTests').appendChild(testDiv);
            
            try {
                const response = await fetch(BASE_URL + endpoint);
                const data = await response.json();
                
                if (response.ok) {
                    testDiv.className = 'test-result success';
                    testDiv.innerHTML = `
                        <strong>✓ ${endpoint}</strong>
                        <pre>${JSON.stringify(data, null, 2).substring(0, 200)}...</pre>
                    `;
                    
                    if (endpoint.includes('live-status')) {
                        displayLiveData(data);
                    }
                } else {
                    testDiv.className = 'test-result error';
                    testDiv.innerHTML = `✗ ${endpoint} - Status: ${response.status}`;
                }
            } catch (error) {
                testDiv.className = 'test-result error';
                testDiv.innerHTML = `✗ ${endpoint} - Error: ${error.message}`;
            }
        }
        
        function displayLiveData(data) {
            const liveDiv = document.getElementById('liveData');
            if (data.isActive) {
                const remainingHours = Math.floor(data.remainingTime / (1000 * 60 * 60));
                const remainingMinutes = Math.floor((data.remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                
                liveDiv.innerHTML = `
                    <div class="test-result success">
                        <h3><span class="live-indicator"></span>Active Session Detected</h3>
                        <p><strong>Session ID:</strong> ${data.activeSessionId}</p>
                        <p><strong>Project:</strong> ${data.currentWindow?.projectId || 'N/A'}</p>
                        <p><strong>Status:</strong> ${data.currentWindow?.status || 'N/A'}</p>
                        <p><strong>Total Tokens:</strong> ${data.currentWindow?.tokenUsage?.totalTokens?.toLocaleString() || 0}</p>
                        <p><strong>Efficiency:</strong> ${data.currentWindow?.efficiency?.toFixed(1) || 0}%</p>
                        <p><strong>Cost Estimate:</strong> $${data.currentWindow?.costEstimate?.toFixed(4) || 0}</p>
                        <p><strong>Time Remaining:</strong> ${remainingHours}h ${remainingMinutes}m</p>
                        <p><strong>Context:</strong> ${data.conversationContext || 'No context'}</p>
                    </div>
                `;
            } else {
                liveDiv.innerHTML = '<div class="test-result">No active session</div>';
            }
        }
        
        // Run all tests
        (async () => {
            for (const endpoint of API_ENDPOINTS) {
                await testEndpoint(endpoint);
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between requests
            }
        })();
    </script>
</body>
</html>