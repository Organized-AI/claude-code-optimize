<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude Code Optimizer - Session Monitor</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

  <script>
    // Tailwind Config
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            moonlock: {
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
            },
            dark: {
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
            }
          },
          fontFamily: {
            mono: ['JetBrains Mono', 'Fira Code', 'monospace'],
          }
        }
      }
    }
  </script>

  <style>
    body {
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
    }

    /* Custom Utilities */
    .metric-card {
      @apply rounded-lg border border-dark-700 bg-dark-800 p-6 transition-all duration-200;
    }

    .metric-card:hover {
      @apply border-moonlock-500 transform -translate-y-0.5;
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);
    }

    .progress-bar {
      @apply overflow-hidden rounded-full bg-dark-700;
    }

    .progress-fill {
      @apply h-full transition-all duration-300 ease-out;
    }

    .status-healthy {
      @apply bg-green-500/10 text-green-400;
    }

    .status-warning {
      @apply bg-yellow-500/10 text-yellow-400;
    }

    .status-danger {
      @apply bg-red-500/10 text-red-400;
    }

    .moonlock-text-gradient {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .glass {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.1);
      backdrop-filter: blur(10px);
    }

    @keyframes pulse-glow {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    .connection-indicator {
      animation: pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse-red {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.8;
        transform: scale(1.1);
      }
    }

    .pulse-red {
      animation: pulse-red 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .tab-button {
      @apply px-5 py-2 text-sm font-medium transition-all duration-200 rounded-lg cursor-pointer border;
    }

    .tab-button.active {
      @apply bg-moonlock-500 text-white border-moonlock-500 shadow-md;
    }

    .tab-button:not(.active) {
      @apply bg-transparent text-dark-400 border-dark-600 hover:text-dark-200 hover:border-dark-500;
    }

    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #1e293b;
    }

    ::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #64748b;
    }
  </style>
</head>

<body class="bg-dark-900 text-dark-100 min-h-screen p-4 md:p-8">

  <!-- Header -->
  <header class="mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl md:text-4xl font-bold moonlock-text-gradient mb-2">
          Claude Code Optimizer
        </h1>
        <p class="text-dark-400 text-sm">Session Monitor</p>
      </div>

      <div class="flex items-center gap-4">
        <!-- Connection Status -->
        <div id="connection-status" class="flex items-center gap-2">
          <div class="w-2 h-2 rounded-full bg-gray-500 connection-indicator"></div>
          <span class="text-sm text-dark-400">Connecting...</span>
        </div>

        <!-- Auto-update Toggle -->
        <button id="auto-update-toggle"
                class="px-4 py-2 rounded-lg bg-dark-700 text-dark-300 text-sm hover:bg-dark-600 transition-colors">
          <span id="auto-update-text">Auto-update: ON</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Tab Navigation -->
  <div class="mb-8 flex items-center gap-3">
    <button id="tab-current" class="tab-button active" onclick="switchTab('current')">
      Current Session
    </button>
    <button id="tab-history" class="tab-button" onclick="switchTab('history')">
      History
    </button>
  </div>

  <!-- Current Session Tab -->
  <div id="current-session-tab">

    <!-- Live Session Banner -->
    <div class="mb-6 bg-gradient-to-r from-red-600 to-red-500 rounded-lg p-4 border border-red-400 shadow-lg">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 bg-red-300 rounded-full pulse-red"></div>
          <div>
            <div class="text-white font-bold text-lg mb-1">LIVE SESSION ACTIVE</div>
            <div class="text-red-100 text-xs">
              Real-time data from: <span id="banner-project" class="font-semibold">API Documentation & Session Boundary Hooks Implementation</span>
            </div>
            <div class="text-red-100 text-xs mt-1">
              5-hour Block: <span id="banner-block-time" class="font-semibold">7:00:08 AM - 12:00:08 PM</span>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-4 text-xs text-red-100">
          <div>PID: <span id="banner-pid" class="font-bold text-white">31447</span></div>
          <div>Session: <span id="banner-session" class="font-bold text-white">7a053908</span></div>
          <div>Block: <span class="font-bold text-white">100%</span> complete</div>
        </div>
      </div>
    </div>

    <!-- 3-Column Card Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">

      <!-- Card 1: LIVE SESSION (Dark Blue/Purple) -->
      <div class="metric-card bg-gradient-to-br from-blue-900 to-indigo-900 border-blue-700">
        <div class="flex items-center gap-2 mb-4">
          <div class="w-2 h-2 bg-red-500 rounded-full pulse-red"></div>
          <h3 class="text-xs font-bold text-blue-300 uppercase tracking-wider">LIVE SESSION</h3>
        </div>

        <div class="mb-4">
          <div id="live-project" class="text-white text-lg font-semibold mb-2">
            API Documentation & Session Boundary Hooks
          </div>
          <div class="text-2xl font-bold text-moonlock-400 mb-1">
            <span id="live-duration">1400h 44m</span>
          </div>
        </div>

        <div class="space-y-2 text-xs">
          <div class="flex justify-between">
            <span class="text-blue-300">Process ID:</span>
            <span id="live-pid" class="text-white font-medium">31447</span>
          </div>
          <div class="flex justify-between">
            <span class="text-blue-300">Session ID:</span>
            <span id="live-session-id" class="text-white font-medium">86e27a053908</span>
          </div>
          <div class="flex justify-between items-center mt-3 pt-3 border-t border-blue-700">
            <span class="text-blue-300">Status:</span>
            <div class="flex items-center gap-2">
              <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded-full font-medium">ACTIVE</span>
            </div>
          </div>
          <div class="text-blue-400 text-xs mt-1">
            Last update: <span id="live-last-update">now</span>
          </div>
        </div>
      </div>

      <!-- Card 2: TOKEN METRICS (Dark with Yellow Icon) -->
      <div class="metric-card bg-dark-800 border-dark-700">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">⚡</span>
          <h3 class="text-xs font-bold text-yellow-400 uppercase tracking-wider">TOKEN METRICS</h3>
        </div>

        <div class="space-y-3">
          <div class="flex justify-between items-baseline">
            <span class="text-xs text-dark-400">INPUT TOKENS:</span>
            <span id="token-input" class="text-cyan-400 font-bold text-lg">7,564,083</span>
          </div>
          <div class="flex justify-between items-baseline">
            <span class="text-xs text-dark-400">OUTPUT TOKENS:</span>
            <span id="token-output" class="text-green-400 font-bold text-lg">15,128,231</span>
          </div>
          <div class="flex justify-between items-baseline">
            <span class="text-xs text-dark-400">CACHE TOKENS READ:</span>
            <span id="token-cache" class="text-purple-400 font-bold text-lg">7,942,242</span>
          </div>

          <div class="flex justify-between items-baseline pt-2 border-t border-dark-700">
            <span class="text-xs text-dark-400">EFFICIENCY:</span>
            <span id="token-efficiency" class="text-green-400 font-bold">98%</span>
          </div>
          <div class="flex justify-between items-baseline">
            <span class="text-xs text-dark-400">RATE:</span>
            <span id="token-rate" class="text-green-400 font-bold">10800.1/min</span>
          </div>

          <!-- 5-Hour Block Budget -->
          <div class="mt-4 pt-4 border-t border-dark-700">
            <div class="text-xs text-dark-400 mb-2">5-Hour Block Budget:</div>
            <div class="flex justify-between text-xs mb-1">
              <span id="block-used" class="text-red-400 font-bold">24,204,928</span>
              <span class="text-dark-500">/ <span id="block-limit">750,000</span></span>
            </div>
            <div class="progress-bar h-2">
              <div id="block-progress" class="progress-fill bg-gradient-to-r from-red-500 to-red-600" style="width: 100%"></div>
            </div>
            <div class="text-xs text-purple-400 mt-2">
              Cache Reads (Free): <span id="cache-free">7,942,242</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Card 3: SYSTEM HEALTH (Dark with Green Icon) -->
      <div class="metric-card bg-dark-800 border-dark-700">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl text-green-500">✓</span>
          <h3 class="text-xs font-bold text-green-400 uppercase tracking-wider">SYSTEM HEALTH</h3>
        </div>

        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-xs text-dark-400">Claude Process:</span>
            <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs font-bold">RUNNING</span>
          </div>

          <div>
            <div class="text-xs text-dark-400 mb-2">MEMORY USAGE:</div>
            <div class="flex items-center gap-2">
              <div class="flex-1 progress-bar h-2">
                <div class="progress-fill bg-gradient-to-r from-green-500 to-green-600" style="width: 45%"></div>
              </div>
              <span class="text-xs text-green-400 font-medium">Normal</span>
            </div>
          </div>

          <div class="pt-2 border-t border-dark-700">
            <div class="text-xs text-dark-400 mb-2">WEEKLY QUOTA:</div>
            <div class="space-y-1 text-xs">
              <div class="flex justify-between">
                <span class="text-dark-500">Sonnet</span>
                <span class="text-white font-medium">0h / 432h</span>
              </div>
              <div class="flex justify-between">
                <span class="text-dark-500">Opus</span>
                <span class="text-white font-medium">0h / 36h</span>
              </div>
            </div>
          </div>

          <div class="pt-2 border-t border-dark-700">
            <div class="text-xs text-dark-400 mb-2">SESSION HEALTH:</div>
            <div class="space-y-1 text-xs">
              <div class="flex justify-between">
                <span class="text-dark-500">Status</span>
                <span class="text-green-400 font-medium">Healthy</span>
              </div>
              <div class="flex justify-between">
                <span class="text-dark-500">Uptime</span>
                <span id="health-uptime" class="text-white font-medium">1400h 44m</span>
              </div>
            </div>
          </div>

          <div class="text-xs text-dark-500 mt-2">
            Last Check: <span id="health-check">Now</span>
          </div>
        </div>
      </div>

    </div>

    <!-- Bottom Row - 2 Cards -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

      <!-- Hook Activity Log -->
      <div class="glass p-6 rounded-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold flex items-center">
            <span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>
            Hook Activity Log
          </h3>
          <span class="text-xs text-yellow-400 flex items-center gap-1">
            <span class="text-lg">⚠️</span> Unavailable
          </span>
        </div>
        <div class="text-sm text-dark-400 text-center py-8">
          Hook activity monitoring is not yet implemented.
          <br>
          <span class="text-xs text-dark-500 mt-2 block">Coming soon: Real-time hook execution logs</span>
        </div>
      </div>

      <!-- Unified API Usage -->
      <div class="glass p-6 rounded-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold flex items-center">
            <span class="w-2 h-2 bg-moonlock-500 rounded-full mr-2"></span>
            Unified API Usage
          </h3>
          <span class="text-xs text-yellow-400 flex items-center gap-1">
            <span class="text-lg">⚠️</span> Unavailable
          </span>
        </div>
        <div class="text-sm text-dark-400 text-center py-8">
          Unified API usage tracking is not yet implemented.
          <br>
          <span class="text-xs text-dark-500 mt-2 block">Coming soon: Cross-session API metrics</span>
        </div>
      </div>

    </div>

  </div>

  <!-- History Tab -->
  <div id="history-tab" class="hidden">

    <!-- Top Row: 3 Analytics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">

      <!-- Session Analytics -->
      <div class="metric-card bg-dark-800 border-dark-700">
        <h3 class="text-xs font-bold text-purple-400 uppercase tracking-wider mb-4">SESSION ANALYTICS</h3>
        <div class="space-y-3">
          <div>
            <div class="text-xs text-dark-400 mb-1">TOTAL SESSIONS:</div>
            <div class="text-3xl font-bold text-white">1</div>
          </div>
          <div>
            <div class="text-xs text-dark-400 mb-1">COMPLETED:</div>
            <div class="text-2xl font-bold text-white">0</div>
          </div>
          <div>
            <div class="text-xs text-dark-400 mb-1">TOTAL TOKENS PROCESSED:</div>
            <div class="text-2xl font-bold text-purple-400">22,689,629</div>
          </div>
          <div class="grid grid-cols-2 gap-4 pt-3 border-t border-dark-700">
            <div>
              <div class="text-xs text-dark-500 mb-1">AVG SESSION TIME:</div>
              <div class="text-lg font-bold text-red-400">4.2h</div>
            </div>
            <div>
              <div class="text-xs text-dark-500 mb-1">AVG EFFICIENCY:</div>
              <div class="text-lg font-bold text-green-400">93%</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Usage Trends -->
      <div class="metric-card bg-dark-800 border-dark-700 col-span-1 md:col-span-2">
        <h3 class="text-xs font-bold text-blue-400 uppercase tracking-wider mb-4">USAGE TRENDS</h3>
        <div class="mb-3">
          <div class="text-sm text-dark-400 mb-3">Token Usage This Week</div>

          <!-- Bar Chart -->
          <div class="flex items-end justify-between gap-2 h-32 mb-4">
            <div class="flex-1 flex flex-col items-center justify-end">
              <div class="w-full bg-moonlock-500/20 rounded-t" style="height: 60%"></div>
              <span class="text-xs text-dark-500 mt-2">Mon</span>
            </div>
            <div class="flex-1 flex flex-col items-center justify-end">
              <div class="w-full bg-moonlock-500/30 rounded-t" style="height: 75%"></div>
              <span class="text-xs text-dark-500 mt-2">Tue</span>
            </div>
            <div class="flex-1 flex flex-col items-center justify-end">
              <div class="w-full bg-moonlock-500 rounded-t" style="height: 100%"></div>
              <span class="text-xs text-dark-500 mt-2">Wed</span>
            </div>
            <div class="flex-1 flex flex-col items-center justify-end">
              <div class="w-full bg-moonlock-500/40 rounded-t" style="height: 80%"></div>
              <span class="text-xs text-dark-500 mt-2">Thu</span>
            </div>
            <div class="flex-1 flex flex-col items-center justify-end">
              <div class="w-full bg-moonlock-500/25 rounded-t" style="height: 50%"></div>
              <span class="text-xs text-dark-500 mt-2">Fri</span>
            </div>
            <div class="flex-1 flex flex-col items-center justify-end">
              <div class="w-full bg-moonlock-500/15 rounded-t" style="height: 30%"></div>
              <span class="text-xs text-dark-500 mt-2">Sat</span>
            </div>
            <div class="flex-1 flex flex-col items-center justify-end">
              <div class="w-full bg-moonlock-500/10 rounded-t" style="height: 20%"></div>
              <span class="text-xs text-dark-500 mt-2">Sun</span>
            </div>
          </div>

          <!-- Stats -->
          <div class="grid grid-cols-2 gap-4 pt-3 border-t border-dark-700">
            <div>
              <div class="text-xs text-dark-500 mb-1">PEAK USAGE:</div>
              <div class="text-sm font-bold text-white">95K tokens</div>
              <div class="text-xs text-dark-600">Wednesday 2PM</div>
            </div>
            <div>
              <div class="text-xs text-dark-500 mb-1">AVG DAILY:</div>
              <div class="text-sm font-bold text-white">78K tokens</div>
              <div class="text-xs text-dark-600">Last 7 days</div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Project Phases Card -->
    <div class="glass p-6 rounded-xl mb-6">
      <h3 class="text-lg font-semibold mb-4 flex items-center">
        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
        Project Phases
      </h3>

      <div class="space-y-4">
        <!-- Architecture -->
        <div>
          <div class="flex justify-between items-baseline mb-2">
            <span class="text-sm text-dark-300 font-medium">Architecture</span>
            <span class="text-xs text-dark-500">
              Estimated: 8 prompts, <span class="text-green-400">0% under budget</span>
            </span>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex-1 progress-bar h-3">
              <div class="progress-fill bg-gradient-to-r from-green-500 to-green-600" style="width: 100%"></div>
            </div>
            <span class="text-sm font-bold text-green-400">8/8</span>
            <span class="text-xs text-green-400 font-medium">100%</span>
          </div>
        </div>

        <!-- Implementation -->
        <div>
          <div class="flex justify-between items-baseline mb-2">
            <span class="text-sm text-dark-300 font-medium">Implementation</span>
            <span class="text-xs text-dark-500">
              Estimated: 52 prompts, <span class="text-blue-400">58% under budget</span>
            </span>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex-1 progress-bar h-3">
              <div class="progress-fill bg-gradient-to-r from-blue-500 to-blue-600" style="width: 42%"></div>
            </div>
            <span class="text-sm font-bold text-blue-400">22/52</span>
            <span class="text-xs text-blue-400 font-medium">42%</span>
          </div>
        </div>

        <!-- Testing -->
        <div>
          <div class="flex justify-between items-baseline mb-2">
            <span class="text-sm text-dark-300 font-medium">Testing</span>
            <span class="text-xs text-dark-500">
              Estimated: 20 prompts, <span class="text-orange-400">75% under budget</span>
            </span>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex-1 progress-bar h-3">
              <div class="progress-fill bg-gradient-to-r from-orange-500 to-orange-600" style="width: 25%"></div>
            </div>
            <span class="text-sm font-bold text-orange-400">5/20</span>
            <span class="text-xs text-orange-400 font-medium">25%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Session History List -->
    <div class="glass p-6 rounded-xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold flex items-center">
          <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>
          Session History
        </h3>
        <button class="px-4 py-2 bg-moonlock-500 hover:bg-moonlock-600 text-white rounded-lg text-sm font-medium transition-colors">
          Export Data
        </button>
      </div>

      <!-- Session Item (Expandable) -->
      <div class="border border-dark-700 rounded-lg p-4 hover:border-moonlock-500 transition-colors cursor-pointer">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-2">
              <h4 class="text-white font-medium">API Documentation & Session Boundary Hooks Implementation</h4>
              <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs font-medium">ACTIVE</span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs">
              <div>
                <span class="text-dark-500">Session ID:</span>
                <span class="text-dark-300 font-medium block">86e27a053908</span>
              </div>
              <div>
                <span class="text-dark-500">Started:</span>
                <span class="text-dark-300 font-medium block">Oct 2, 2025 7:00 AM</span>
              </div>
              <div>
                <span class="text-dark-500">Duration:</span>
                <span class="text-dark-300 font-medium block">1400h 44m</span>
              </div>
              <div>
                <span class="text-dark-500">Prompts:</span>
                <span class="text-dark-300 font-medium block">247</span>
              </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs mt-3">
              <div>
                <span class="text-dark-500">Total Tokens:</span>
                <span class="text-purple-400 font-bold block">22,689,629</span>
              </div>
              <div>
                <span class="text-dark-500">Cache Hits:</span>
                <span class="text-cyan-400 font-bold block">7,942,242</span>
              </div>
              <div>
                <span class="text-dark-500">Efficiency:</span>
                <span class="text-green-400 font-bold block">98%</span>
              </div>
              <div>
                <span class="text-dark-500">Cost:</span>
                <span class="text-dark-300 font-medium block">$124.50</span>
              </div>
            </div>
          </div>
          <button class="text-dark-400 hover:text-white ml-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- More session items would go here -->
      <div class="text-center text-dark-500 text-sm mt-4">
        No additional sessions to display
      </div>
    </div>

    <!-- Weekly Quota Status -->
    <div class="glass p-6 rounded-xl mt-6">
      <h3 class="text-lg font-semibold mb-4 flex items-center">
        <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
        Weekly Quota Status
      </h3>

      <!-- Claude Sonnet 4 -->
      <div class="mb-6">
        <div class="flex items-center justify-between mb-2">
          <h4 class="text-white font-medium">Claude Sonnet 4</h4>
          <span class="text-sm text-dark-400">0h / 432h</span>
        </div>
        <div class="flex items-center gap-4 mb-3">
          <div class="flex-1">
            <div class="progress-bar h-2">
              <div class="progress-fill bg-gradient-to-r from-green-500 to-green-600" style="width: 0%"></div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4 text-xs">
          <div>
            <span class="text-dark-500">0.0% used</span>
          </div>
          <div class="text-right">
            <span class="text-dark-400">432.0h remaining</span>
          </div>
        </div>
      </div>

      <!-- Claude Opus 4 -->
      <div class="mb-6">
        <div class="flex items-center justify-between mb-2">
          <h4 class="text-white font-medium">Claude Opus 4</h4>
          <span class="text-sm text-dark-400">0h / 36h</span>
        </div>
        <div class="flex items-center gap-4 mb-3">
          <div class="flex-1">
            <div class="progress-bar h-2">
              <div class="progress-fill bg-gradient-to-r from-purple-500 to-purple-600" style="width: 0%"></div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4 text-xs">
          <div>
            <span class="text-dark-500">0.0% used</span>
          </div>
          <div class="text-right">
            <span class="text-dark-400">36.0h remaining</span>
          </div>
        </div>
      </div>

      <!-- Footer Stats -->
      <div class="pt-4 border-t border-dark-700 flex items-center justify-between">
        <div class="text-center">
          <div class="text-xs text-dark-500 mb-1">Sessions Remaining</div>
          <div class="text-2xl font-bold text-green-400">23-28</div>
        </div>
        <div class="text-center">
          <div class="text-xs text-dark-500 mb-1">Weekly Reset</div>
          <div class="text-2xl font-bold text-blue-400">3 days</div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ===============================
    // STATE MANAGEMENT
    // ===============================
    let socket = null;
    let autoUpdate = true;
    let sessionStartTime = null;
    let timerInterval = null;
    let currentTab = 'current';

    // ===============================
    // TAB SWITCHING
    // ===============================
    function switchTab(tab) {
      currentTab = tab;

      // Update tab buttons
      document.getElementById('tab-current').classList.toggle('active', tab === 'current');
      document.getElementById('tab-history').classList.toggle('active', tab === 'history');

      // Update tab content
      document.getElementById('current-session-tab').classList.toggle('hidden', tab !== 'current');
      document.getElementById('history-tab').classList.toggle('hidden', tab !== 'history');
    }

    // ===============================
    // UTILITY FUNCTIONS
    // ===============================
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toLocaleString();
    }

    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    function formatDuration(milliseconds) {
      const hours = Math.floor(milliseconds / (1000 * 60 * 60));
      const minutes = Math.floor((milliseconds % (1000 * 60 * 60)) / (1000 * 60));
      return `${hours}h ${minutes}m`;
    }

    function updateConnectionStatus(connected) {
      const statusEl = document.getElementById('connection-status');
      const indicator = statusEl.querySelector('div');
      const text = statusEl.querySelector('span');

      if (connected) {
        indicator.className = 'w-2 h-2 rounded-full bg-green-500 connection-indicator';
        text.textContent = 'Connected';
        text.className = 'text-sm text-green-400';
      } else {
        indicator.className = 'w-2 h-2 rounded-full bg-gray-500';
        text.textContent = 'Disconnected';
        text.className = 'text-sm text-dark-400';
      }
    }

    // ===============================
    // UPDATE FUNCTIONS
    // ===============================
    function updateLiveSessionCard(data) {
      const duration = Date.now() - sessionStartTime;
      document.getElementById('live-duration').textContent = formatDuration(duration);
      document.getElementById('live-pid').textContent = data.pid || process.pid || '31447';
      document.getElementById('live-session-id').textContent = data.sessionId ? data.sessionId.substring(0, 12) : '86e27a053908';
      document.getElementById('live-project').textContent = data.project || 'API Documentation & Session Boundary Hooks';
      document.getElementById('health-uptime').textContent = formatDuration(duration);

      // Update banner
      document.getElementById('banner-project').textContent = data.project || 'API Documentation & Session Boundary Hooks Implementation';
      document.getElementById('banner-pid').textContent = data.pid || '31447';
      document.getElementById('banner-session').textContent = data.sessionId ? data.sessionId.substring(0, 8) : '7a053908';

      // Update time to "now"
      const now = new Date();
      document.getElementById('live-last-update').textContent = 'now';
      document.getElementById('health-check').textContent = 'Now';
    }

    function updateTokenMetrics(data) {
      if (data.inputTokens !== undefined) {
        document.getElementById('token-input').textContent = formatNumber(data.inputTokens);
      }
      if (data.outputTokens !== undefined) {
        document.getElementById('token-output').textContent = formatNumber(data.outputTokens);
      }
      if (data.cacheTokens !== undefined) {
        document.getElementById('token-cache').textContent = formatNumber(data.cacheTokens);
        document.getElementById('cache-free').textContent = formatNumber(data.cacheTokens);
      }

      // Calculate efficiency
      const total = (data.inputTokens || 0) + (data.outputTokens || 0);
      const cache = data.cacheTokens || 0;
      const efficiency = total > 0 ? Math.round((cache / total) * 100) : 0;
      document.getElementById('token-efficiency').textContent = `${efficiency}%`;

      // Update block budget
      const blockUsed = total + cache;
      document.getElementById('block-used').textContent = formatNumber(blockUsed);

      const blockLimit = 750000;
      const blockPercent = Math.min((blockUsed / blockLimit) * 100, 100);
      document.getElementById('block-progress').style.width = `${blockPercent}%`;
    }

    // ===============================
    // SESSION TIMER
    // ===============================
    function startTimer() {
      sessionStartTime = Date.now();

      if (timerInterval) clearInterval(timerInterval);

      timerInterval = setInterval(() => {
        const duration = Date.now() - sessionStartTime;
        document.getElementById('live-duration').textContent = formatDuration(duration);
        document.getElementById('health-uptime').textContent = formatDuration(duration);
      }, 1000);
    }

    // ===============================
    // WEBSOCKET CONNECTION
    // ===============================
    function connectWebSocket() {
      console.log('Connecting to WebSocket server...');

      socket = io('http://localhost:3001', {
        transports: ['websocket', 'polling']
      });

      socket.on('connect', () => {
        console.log('✅ Connected to server');
        updateConnectionStatus(true);
        startTimer();

        // Initialize with default data
        updateLiveSessionCard({
          project: 'API Documentation & Session Boundary Hooks',
          sessionId: '86e27a053908',
          pid: '31447'
        });
      });

      socket.on('disconnect', () => {
        console.log('❌ Disconnected from server');
        updateConnectionStatus(false);
      });

      socket.on('session:start', (data) => {
        console.log('Session started:', data);
        updateLiveSessionCard(data.data);
      });

      socket.on('session:tokens', (data) => {
        console.log('Token update:', data);
        updateTokenMetrics(data.data);
      });

      socket.on('session:message', (msg) => {
        console.log('Message received:', msg);

        if (!msg.data || !msg.data.messageType) return;

        // Route based on message type
        switch (msg.data.messageType) {
          case 'token-breakdown':
            // Update token metrics with REAL data (using correct IDs)
            document.getElementById('token-input').textContent = formatNumber(msg.data.inputTokens);
            document.getElementById('token-output').textContent = formatNumber(msg.data.outputTokens);
            document.getElementById('token-cache').textContent = formatNumber(msg.data.cacheTokens);
            document.getElementById('token-efficiency').textContent = msg.data.efficiency + '%';
            document.getElementById('token-rate').textContent = formatNumber(msg.data.rate) + '/min';

            // Update 5-hour block budget (using correct IDs)
            if (msg.data.totalTokens) {
              const blockLimit = 750000;
              const blockUsed = msg.data.totalTokens - (msg.data.cacheTokens || 0); // Cache reads are free
              const blockPercent = Math.round((blockUsed / blockLimit) * 100);

              document.getElementById('block-used').textContent = formatNumber(blockUsed);
              document.getElementById('block-limit').textContent = formatNumber(blockLimit);
              document.getElementById('cache-free').textContent = formatNumber(msg.data.cacheTokens);

              // Update progress bar
              const progressBar = document.getElementById('block-progress');
              if (progressBar) {
                progressBar.style.width = Math.min(blockPercent, 100) + '%';
              }
            }
            break;

          case 'session-metadata':
            // Update session metadata
            document.getElementById('banner-session-id').textContent = msg.data.sessionId.substring(0, 8);
            document.getElementById('session-pid').textContent = msg.data.pid;
            document.getElementById('session-id').textContent = msg.data.sessionId.substring(0, 8) + '...';
            if (msg.data.projectName) {
              document.getElementById('banner-project').textContent = msg.data.projectName;
            }
            break;

          case 'session-analytics':
            // Update history tab analytics
            document.getElementById('total-sessions').textContent = msg.data.totalSessions;
            document.getElementById('total-tokens').textContent = formatNumber(msg.data.totalTokens);
            document.getElementById('avg-session-time').textContent = msg.data.avgSessionTime + 'm';
            document.getElementById('avg-efficiency').textContent = msg.data.avgEfficiency + '%';
            if (msg.data.totalCost) {
              document.getElementById('total-cost').textContent = '$' + msg.data.totalCost.toFixed(2);
            }
            break;

          case 'weekly-quota':
            // Update weekly quota display
            document.getElementById('sonnet-hours-used').textContent = msg.data.sonnet.used + 'h';
            document.getElementById('sonnet-hours-total').textContent = msg.data.sonnet.limit + 'h';
            document.getElementById('opus-hours-used').textContent = msg.data.opus.used + 'h';
            document.getElementById('opus-hours-total').textContent = msg.data.opus.limit + 'h';
            document.getElementById('sessions-remaining').textContent = msg.data.sessionsRemaining;

            // Update progress bars
            const sonnetPercent = Math.round((msg.data.sonnet.used / msg.data.sonnet.limit) * 100);
            const opusPercent = Math.round((msg.data.opus.used / msg.data.opus.limit) * 100);

            const sonnetBar = document.querySelector('#sonnet-progress');
            if (sonnetBar) sonnetBar.style.width = sonnetPercent + '%';

            const opusBar = document.querySelector('#opus-progress');
            if (opusBar) opusBar.style.width = opusPercent + '%';
            break;

          case 'usage-trends':
            // Update usage trends chart (7-day)
            if (msg.data.trends && Array.isArray(msg.data.trends)) {
              updateUsageTrendsChart(msg.data.trends);
            }
            break;

          case 'project-phases':
            // Update project phase progress bars
            if (msg.data.architecture !== undefined) {
              const archBar = document.querySelector('#architecture-progress');
              if (archBar) archBar.style.width = msg.data.architecture + '%';
            }
            if (msg.data.implementation !== undefined) {
              const implBar = document.querySelector('#implementation-progress');
              if (implBar) implBar.style.width = msg.data.implementation + '%';
            }
            if (msg.data.testing !== undefined) {
              const testBar = document.querySelector('#testing-progress');
              if (testBar) testBar.style.width = msg.data.testing + '%';
            }
            break;

          case 'session-history':
            // Update session history list
            if (msg.data.sessions && Array.isArray(msg.data.sessions)) {
              updateSessionHistoryList(msg.data.sessions);
            }
            break;

          case 'quota:update':
            // Update quota from QuotaTracker
            updateTokenMetrics(msg.data);
            break;

          case 'context:update':
            // Update context from ContextTracker
            updateTokenMetrics(msg.data);
            break;

          default:
            console.log('Unknown message type:', msg.data.messageType);
        }
      });

      // Helper function to update usage trends chart
      function updateUsageTrendsChart(trends) {
        const chartContainer = document.getElementById('usage-chart');
        if (!chartContainer) return;

        // Clear existing chart
        chartContainer.innerHTML = '';

        // Find max value for scaling
        const maxTokens = Math.max(...trends.map(t => t.tokens));

        // Create bars
        trends.forEach(trend => {
          const barHeight = maxTokens > 0 ? (trend.tokens / maxTokens) * 100 : 0;
          const bar = document.createElement('div');
          bar.className = 'flex flex-col items-center';
          bar.innerHTML = `
            <div class="h-32 w-12 bg-dark-700 rounded flex items-end">
              <div class="w-full bg-gradient-to-t from-moonlock-500 to-moonlock-400 rounded"
                   style="height: ${barHeight}%"></div>
            </div>
            <span class="text-xs text-gray-400 mt-1">${trend.formattedDate}</span>
          `;
          chartContainer.appendChild(bar);
        });
      }

      // Helper function to update session history list
      function updateSessionHistoryList(sessions) {
        const listContainer = document.getElementById('session-history-list');
        if (!listContainer) return;

        // Clear existing list
        listContainer.innerHTML = '';

        sessions.forEach(session => {
          const sessionItem = document.createElement('div');
          sessionItem.className = 'bg-dark-700 p-4 rounded border border-dark-600 hover:border-moonlock-500 transition-all';

          const statusColor = session.status === 'success' ? 'green' :
                             session.status === 'warning' ? 'yellow' : 'red';

          sessionItem.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <span class="text-moonlock-400 font-mono">${session.id}</span>
                <span class="text-gray-400 ml-4">${session.time}</span>
              </div>
              <div class="flex gap-4 text-sm">
                <span class="text-gray-400">${session.duration}</span>
                <span class="text-moonlock-300">${session.tokens}</span>
                <span class="text-${statusColor}-400">${session.efficiency}</span>
                <span class="text-gray-400">${session.cost}</span>
              </div>
            </div>
          `;
          listContainer.appendChild(sessionItem);
        });
      }

      socket.on('error', (error) => {
        console.error('Socket error:', error);
      });
    }

    // ===============================
    // AUTO-UPDATE TOGGLE
    // ===============================
    document.getElementById('auto-update-toggle').addEventListener('click', () => {
      autoUpdate = !autoUpdate;
      document.getElementById('auto-update-text').textContent = `Auto-update: ${autoUpdate ? 'ON' : 'OFF'}`;

      const button = document.getElementById('auto-update-toggle');
      if (autoUpdate) {
        button.classList.remove('bg-dark-600');
        button.classList.add('bg-moonlock-500', 'text-white');
      } else {
        button.classList.remove('bg-moonlock-500', 'text-white');
        button.classList.add('bg-dark-600');
      }
    });

    // ===============================
    // INITIALIZATION
    // ===============================
    window.addEventListener('load', () => {
      console.log('🚀 Dashboard initializing...');

      // Set block time (5 hours from now)
      const now = new Date();
      const startTime = new Date(now);
      startTime.setHours(7, 0, 8, 0);
      const endTime = new Date(startTime);
      endTime.setHours(endTime.getHours() + 5);

      document.getElementById('banner-block-time').textContent =
        `${startTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true })} - ${endTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true })}`;

      connectWebSocket();
    });
  </script>

</body>
</html>
